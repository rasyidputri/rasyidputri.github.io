(()=>{var b=(()=>{let l='<span class="spinner-border spinner-border-sm my-0 ms-0 me-1 p-0" style="height: 0.8rem; width: 0.8rem;"></span>',f=c=>String(c).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),y=(c,v,u=.05)=>new Promise(E=>{let H=parseFloat(c.style.opacity),d=v?1:0,p=()=>{H+=v?u:-u,H=Math.max(0,Math.min(1,H)),c.style.opacity=H.toFixed(2),v&&H>=d||!v&&H<=d?(c.style.opacity=d.toString(),E(c)):requestAnimationFrame(p)};requestAnimationFrame(p)}),s=(c,v)=>{let u=null;u=setTimeout(()=>{c(),clearTimeout(u),u=null},v)};return{loader:l,copy:async(c,v=null,u=1500)=>{let E=c.getAttribute("data-copy");if(!E||E.length===0){alert("Nothing to copy");return}c.disabled=!0;try{await navigator.clipboard.writeText(E)}catch{c.disabled=!1,alert("Failed to copy");return}let H=c.innerHTML;c.innerHTML=v||'<i class="fa-solid fa-check"></i>',s(()=>{c.disabled=!1,c.innerHTML=H},u)},timeOut:s,debounce:(c,v)=>{let u=null;return(...E)=>{clearTimeout(u),u=setTimeout(()=>c(...E),v)}},escapeHtml:f,base64Encode:c=>{let u=new TextEncoder().encode(c);return window.btoa(String.fromCharCode(...u))},base64Decode:c=>{let v=new TextDecoder,u=Uint8Array.from(window.atob(c),E=>E.charCodeAt(0));return v.decode(u)},disableButton:(c,v="Loading",u=!1)=>{c.disabled=!0;let E=c.innerHTML;return c.innerHTML=u?v:l+v,{restore:(H=!1)=>{c.innerHTML=E,c.disabled=H}}},disableCheckbox:c=>{c.disabled=!0;let v=document.querySelector(`label[for="${c.id}"]`),u=v.innerHTML;return v.innerHTML=l+u,{restore:()=>{v.innerHTML=u,c.disabled=!1}}},parseUserAgent:c=>{let v=[{type:"Mobile",regex:/Android.*Mobile|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i},{type:"Tablet",regex:/iPad|Android(?!.*Mobile)|Tablet/i},{type:"Desktop",regex:/Windows NT|Macintosh|Linux/i}],u=[{name:"Chrome",regex:/Chrome|CriOS/i},{name:"Safari",regex:/Safari/i},{name:"Edge",regex:/Edg|Edge/i},{name:"Firefox",regex:/Firefox|FxiOS/i},{name:"Opera",regex:/Opera|OPR/i},{name:"Internet Explorer",regex:/MSIE|Trident/i}],E=[{name:"Windows",regex:/Windows NT ([\d.]+)/i},{name:"MacOS",regex:/Mac OS X ([\d_]+)/i},{name:"Android",regex:/Android ([\d.]+)/i},{name:"iOS",regex:/OS ([\d_]+) like Mac OS X/i},{name:"Linux",regex:/Linux/i}],H=v.find(M=>M.regex.test(c))?.type||"Unknown",d=u.find(M=>M.regex.test(c))?.name||"Unknown",p=E.find(M=>M.regex.test(c)),$=p&&c.match(p.regex)?.[1]?.replace(/_/g,".")||"",U=p?p.name:"Unknown";return $=$?`${U} ${$}`:U,`${d} ${H} ${$}`},changeOpacity:y}})();var ne={tab:y=>window.bootstrap.Tab.getOrCreateInstance(document.getElementById(y)),modal:y=>window.bootstrap.Modal.getOrCreateInstance(document.getElementById(y))};var D=(()=>{let l=(u,E,H)=>({code:u,data:E,error:H}),f=(u=0)=>({love:u}),y=({uuid:u,own:E,name:H,presence:d,comment:p,created_at:$,is_admin:U,gif_url:M,ip:V,user_agent:e,comments:n,like:r})=>({uuid:u,own:E,name:H,presence:d,comment:p,created_at:$,is_admin:U??!1,gif_url:M,ip:V,user_agent:e,comments:n?.map(y)??[],like:f(r?.love??0)}),s=u=>u.map(y);return{uuidResponse:({uuid:u})=>({uuid:u}),baseResponse:l,tokenResponse:({token:u})=>({token:u}),statusResponse:({status:u})=>({status:u}),commentResponse:({name:u,presence:E,comment:H,is_admin:d,gif_url:p,created_at:$})=>({name:u,presence:E,comment:H,is_admin:d,gif_url:p,created_at:$}),likeCommentResponse:f,getCommentResponse:y,getCommentsResponse:s,getCommentsResponseV2:u=>({count:u.count,lists:s(u.lists)}),commentShowMore:(u,E=!1)=>({uuid:u,show:E}),postCommentRequest:(u,E,H,d,p)=>({id:u,name:E,presence:H,comment:d,gif_id:p}),postSessionRequest:(u,E)=>({email:u,password:E}),updateCommentRequest:(u,E,H)=>({presence:u,comment:E,gif_id:H})}})();var S=l=>{let f=(i=null)=>{let g=JSON.parse(localStorage.getItem(l));return i?g[String(i)]:g},y=(i,g)=>{let k=f();k[String(i)]=g,localStorage.setItem(l,JSON.stringify(k))},s=i=>Object.keys(f()).includes(String(i)),a=i=>{if(!s(i))return;let g=f();delete g[String(i)],localStorage.setItem(l,JSON.stringify(g))},o=()=>localStorage.setItem(l,"{}");return localStorage.getItem(l)||o(),{set:y,get:f,has:s,clear:o,unset:a}};var j="GET",oe="PUT",Z="POST",X="PATCH",re="DELETE",Y=200,se=201,fe=500,Q={Accept:"application/json","Content-Type":"application/json"},P=(l,f)=>{let y=new AbortController,s=document.body.getAttribute("data-url"),a={signal:y.signal,method:String(l).toUpperCase(),headers:new Headers(Q)};return window.addEventListener("offline",()=>y.abort()),window.addEventListener("popstate",()=>y.abort()),s&&s.slice(-1)==="/"&&(s=s.slice(0,-1)),{send(o=null){return fetch(s+f,a).then(i=>i.json().then(g=>{if(i.status>=fe&&(g.message??g[0]))throw new Error(g.message??g[0]);if(g.error)throw new Error(g.error[0]);return o&&(g.data=o(g.data)),D.baseResponse(g.code,g.data,g.error)})).catch(i=>{if(i.name==="AbortError")return console.warn("Fetch abort:",i),i;throw alert(i),new Error(i)})},withCancel(o){return(async()=>(await o,y.abort()))(),this},default(o=null){return a.headers=new Headers(o??{}),fetch(f,a)},download(){return Object.keys(Q).forEach(o=>a.headers.delete(o)),fetch(s+f,a).then(o=>{if(o.status!==Y)return!1;let i=document.querySelector("a[download]");i&&document.body.removeChild(i);let g=o.headers.get("content-disposition")?.match(/filename="(.+)"/)?.[1]??"download.csv";return o.blob().then(k=>{let w=document.createElement("a"),I=window.URL.createObjectURL(k);return w.href=I,w.download=g,document.body.appendChild(w),w.click(),document.body.removeChild(w),window.URL.revokeObjectURL(I),!0})}).catch(o=>{if(o.name==="AbortError")return console.warn("Fetch abort:",o),o;throw alert(o),new Error(o)})},token(o){return o.split(".").length===3?(a.headers.append("Authorization","Bearer "+o),this):(a.headers.append("x-access-key",o),this)},body(o){return a.body=JSON.stringify(o),this}}};var A=(()=>{let l=null,f=()=>l.get("token"),y=w=>l.set("token",w),s=w=>P(Z,"/api/session").body(w).send(D.tokenResponse).then(I=>(I.code===Y&&y(I.data.token),I.code===Y),()=>!1),a=()=>l.unset("token"),o=()=>String(f()??".").split(".").length===3;return{init:()=>{l=S("session")},guest:()=>P(j,"/api/config").token(f()).send().then(w=>{if(w.code!==Y)throw new Error("failed to get config.");let I=S("config");for(let[c,v]of Object.entries(w.data))I.set(c,v);return w}),login:s,logout:a,decode:()=>{if(!o())return null;try{return JSON.parse(window.atob(f().split(".")[1]))}catch{return null}},isAdmin:o,setToken:y,getToken:f}})();var ee=(()=>{let l=null,f=async i=>{let g=b.disableButton(i),k=document.getElementById("loginEmail"),w=document.getElementById("loginPassword");k.disabled=!0,w.disabled=!0,await A.login(D.postSessionRequest(k.value,w.value))&&(k.value=null,w.value=null,ne.modal("mainModal").hide()),g.restore(),k.disabled=!1,w.disabled=!1},y=()=>{l.clear(),A.logout(),ne.modal("mainModal").show()};return{init:()=>{l=S("user")},login:f,clearSession:y,getDetailUser:()=>P(j,"/api/user").token(A.getToken()).send().then(i=>{if(i.code!==Y)throw new Error("failed to get user.");return Object.entries(i.data).forEach(([g,k])=>l.set(g,k)),i},i=>(y(),i)),getUserStorage:()=>l}})();var le=(()=>{let l=(s,a)=>{document.querySelectorAll(".navbar button").forEach(o=>{o.classList.contains("active")&&o.classList.remove("active")}),ne.tab(a).show(),s.classList.add("active")};return{buttonNavHome:s=>{l(s,"button-home")},buttonNavSetting:s=>{l(s,"button-setting")}}})();var ae=(()=>{let l={"#000000":"#ffffff","#ffffff":"#000000","#212529":"#f8f9fa","#f8f9fa":"#212529"},f=["#ffffff","#f8f9fa"],y=["#000000","#212529"],s=!1,a=null,o=null,i=()=>a.set("active","light"),g=()=>a.set("active","dark"),k=d=>{let p=o.getAttribute("content");o.setAttribute("content",d.some($=>$===p)?l[p]:p)},w=()=>{i(),document.documentElement.setAttribute("data-bs-theme","light"),k(y)},I=()=>{g(),document.documentElement.setAttribute("data-bs-theme","dark"),k(f)},c=(d=null,p=null)=>{let $=a.get("active")==="dark";return d&&p?$?d:p:$};return{init:()=>{switch(a=S("theme"),o=document.querySelector('meta[name="theme-color"]'),a.has("active")||(window.matchMedia("(prefers-color-scheme: dark)").matches?g():i()),document.documentElement.getAttribute("data-bs-theme")){case"dark":g();break;case"light":i();break;default:s=!0}c()?I():w()},spyTop:()=>{let d=$=>$.filter(U=>U.isIntersecting).forEach(U=>{let M=U.target.classList.contains("bg-white-black")?c(y[0],f[0]):c(y[1],f[1]);o.setAttribute("content",M)}),p=new IntersectionObserver(d,{rootMargin:"0% 0% -95% 0%"});document.querySelectorAll("section").forEach($=>p.observe($))},change:()=>c()?w():I(),isDarkMode:c,isAutoMode:()=>s}})();var K=(()=>{let l={id:"ID",en:"US",fr:"FR",de:"DE",es:"ES",zh:"CN",ja:"JP",ko:"KR",ar:"SA",ru:"RU",it:"IT",nl:"NL",pt:"PT",tr:"TR",th:"TH",vi:"VN",ms:"MY",hi:"IN"},f=null,y=null,s=null,a=null;return{on(o,i){return a.set(o,i),this},get(){let o=a.get(s);return a.clear(),o},getCountry(){return f},getLocale(){return y},getLanguage(){return s},setDefault(o){let i=!0;l[o]||(i=!1,console.warn("Language not found, please add manually in countryMapping")),f=i?l[o]:"US",s=i?o:"en",y=`${s}_${f}`},init(){a=new Map,this.setDefault(navigator.language)}}})();var de=(()=>{let l=null,f=!0,y=["input[data-offline-disabled]","button[data-offline-disabled]","select[data-offline-disabled]","textarea[data-offline-disabled]"],s=()=>f,a=()=>{let c=l.firstElementChild.firstElementChild;c.classList.remove("bg-success"),c.classList.add("bg-danger"),c.firstElementChild.innerHTML='<i class="fa-solid fa-ban me-2"></i>Koneksi tidak tersedia'},o=()=>{let c=l.firstElementChild.firstElementChild;c.classList.remove("bg-danger"),c.classList.add("bg-success"),c.firstElementChild.innerHTML='<i class="fa-solid fa-cloud me-2"></i>Koneksi tersedia kembali'},i=async()=>{f&&(await b.changeOpacity(l,!1),a())},g=()=>{document.querySelectorAll(y.join(", ")).forEach(c=>{c.dispatchEvent(new Event(s()?"online":"offline")),c.setAttribute("data-offline-disabled",s()?"false":"true"),c.tagName==="BUTTON"?s()?c.classList.remove("disabled"):c.classList.add("disabled"):s()?c.removeAttribute("disabled"):c.setAttribute("disabled","true")})},k=()=>{f=!1,a(),b.changeOpacity(l,!0),g()},w=()=>{f=!0,o(),b.timeOut(i,3e3),g()};return{init:()=>{window.addEventListener("online",w),window.addEventListener("offline",k),l=document.getElementById("offline-mode"),l.innerHTML=`
        <div class="d-flex justify-content-center mx-auto">
            <div class="d-flex justify-content-center align-items-center rounded-pill my-2 bg-danger shadow">
                <small class="text-center py-1 px-2 mx-1 mt-1 mb-0 text-white" style="font-size: 0.8rem;"></small>
            </div>
        </div>`},isOnline:s}})();var O=(()=>{let l="gifs",f="default",y={128:2,256:3,512:4,768:5},s=null,a=null,o=null,i=null,g=async t=>{if(s.has(t))return s.get(t);let m=(C,B=3,T=1e3)=>P(j,t).default().then(N=>N.blob().then(z=>C.put(t,new Response(z,{headers:new Headers(N.headers)})).then(()=>z))).catch(N=>{if(B<=0)throw N;return console.warn("Retrying fetch:"+t),new Promise((z,J)=>b.timeOut(()=>m(C,B-1,T+1e3).then(z,J),T))}),x=C=>C.match(t).then(B=>{if(!B)return m(C);let T=B.headers.get("expires"),N=T?new Date(T).getTime():0;return Date.now()>N?C.delete(t).then(z=>z?m(C):B.blob()):B.blob()});return await caches.open(l).then(C=>x(C)).then(C=>URL.createObjectURL(C)).then(C=>(s.set(t,C),C))},k=async(t,m)=>{let{id:x,media_formats:{tinygif:{url:R}},content_description:C}=m;t.pointer===-1||t.pointer===t.col-1?t.pointer=0:t.pointer++;let B=0;for(let T of t.lists.childNodes){if(B===t.pointer){await g(R).then(N=>{T.insertAdjacentHTML("beforeend",`
                    <figure class="gif-figure m-0 position-relative">
                        <button onclick="undangan.comment.gif.click('${t.uuid}', '${x}', '${b.base64Encode(R)}')" class="btn gif-checklist position-absolute justify-content-center align-items-center top-0 end-0 bg-overlay-auto p-1 m-1 rounded-circle border shadow-sm z-1">
                            <i class="fa-solid fa-circle-check"></i>
                        </button>
                        <img src="${N}" class="img-fluid" alt="${b.escapeHtml(C)}" style="width: 100%;">
                    </figure>`)});return}B++}},w=t=>{let m=t.lists,x=document.getElementById(`gif-loading-${t.uuid}`),R=document.getElementById(`progress-bar-${t.uuid}`),C=document.getElementById(`progress-info-${t.uuid}`),B=0,T=0;return m.classList.contains("d-none")||x.classList.replace("d-none","d-flex"),C.innerText=`${T}/${B}`,m.setAttribute("data-continue","false"),m.classList.replace("overflow-y-scroll","overflow-y-hidden"),{release:()=>{m.classList.contains("d-none")||x.classList.replace("d-flex","d-none"),R.style.width="0%",C.innerText=`${T}/${B}`,m.setAttribute("data-continue","true"),m.classList.replace("overflow-y-hidden","overflow-y-scroll")},until:W=>{B=W,C.innerText=`${T}/${B}`},step:()=>{T+=1,C.innerText=`${T}/${B}`,R.style.width=Math.min(T/B*100,100).toString()+"%"}}},I=(t,m,x)=>{x={media_filter:"tinygif",client_key:"undangan_app",key:i.get("tenor_key"),country:K.getCountry(),locale:K.getLocale(),...x??{}};let R=Object.keys(x).filter(T=>x[T]!==null&&x[T]!==void 0).map(T=>`${T}=${encodeURIComponent(x[T])}`).join("&"),C=`https://tenor.googleapis.com/v2${m}?${R}`,B=new Promise(T=>{t.reqs.push(T)});t.last=new Promise(T=>{let N=!0;(async()=>(await B,N=!1))(),(async()=>{let z=w(t);try{let J=await P(j,C).withCancel(B).default(Q).then(W=>W.json()).then(W=>{if(!W.error)return W;throw new Error(W.error.message)});if(J.results.length>0){t.next=J?.next,z.until(J.results.length);for(let W of J.results)try{N&&(t.gifs.push(W),await k(t,W),z.step())}catch(ue){throw N=!1,ue}}}catch(J){N=!1,J.name==="AbortError"?console.warn("Fetch abort:",J):alert(J)}finally{z.release(),T()}})()})},c=t=>`
        <label for="gif-search-${t}" class="form-label my-1"><i class="fa-solid fa-photo-film me-2"></i>Gif</label>

        <div class="d-flex mb-3" id="gif-search-nav-${t}">
            <button class="btn btn-secondary btn-sm rounded-4 shadow-sm me-1 my-1" onclick="undangan.comment.gif.back(this, '${t}')" data-offline-disabled="false"><i class="fa-solid fa-arrow-left"></i></button>
            <input type="text" name="gif-search" id="gif-search-${t}" autocomplete="on" class="form-control shadow-sm rounded-4" placeholder="Search for a GIF on Tenor" data-offline-disabled="false">
        </div>

        <div class="position-relative">
            <div class="position-absolute d-flex flex-column justify-content-center align-items-center top-50 start-50 translate-middle w-100 h-100 bg-overlay-auto rounded-4 z-3" id="gif-loading-${t}">
                <div class="progress w-25" role="progressbar" style="height: 0.5rem;" aria-label="progress bar">
                    <div class="progress-bar" id="progress-bar-${t}" style="width: 0%"></div>
                </div>
                <small class="mt-1 text-theme-auto bg-theme-auto py-0 px-2 rounded-4" id="progress-info-${t}" style="font-size: 0.7rem;"></small>
            </div>
            <div id="gif-lists-${t}" class="d-flex rounded-4 p-0 overflow-y-scroll border" data-continue="true" style="height: 15rem;"></div>
        </div>

        <figure class="d-flex m-0 position-relative" id="gif-result-${t}">
            <button onclick="undangan.comment.gif.cancel('${t}')" id="gif-cancel-${t}" class="btn d-none position-absolute justify-content-center align-items-center top-0 end-0 bg-overlay-auto p-2 m-1 rounded-circle border shadow-sm z-1">
                <i class="fa-solid fa-circle-xmark"></i>
            </button>
        </figure>`,v=async t=>{t.reqs.forEach(m=>m()),t.reqs=[],t.last&&(await t.last,t.last=null)},u=async t=>{await v(t);let m=0;for(let[R,C]of Object.entries(y))m=C,t.lists.clientWidth>=parseInt(R)&&(t.col=m);if(t.col===null&&(t.col=m),t.pointer=-1,t.limit=t.col*5,t.lists.innerHTML='<div class="d-flex flex-column"></div>'.repeat(t.col),t.gifs.length===0)return;let x=w(t);x.until(t.gifs.length);for(let R of t.gifs)try{await k(t,R),x.step()}catch{t.gifs=[];break}x.release(),t.gifs.length===0&&await u(t)},E=async t=>{if(t.lists.getAttribute("data-continue")!=="true"||!t.next||t.next.length===0)return;let m=t.query&&t.query.trim().length>0,x={pos:t.next,limit:t.limit};m&&(x.q=t.query),t.lists.scrollTop>(t.lists.scrollHeight-t.lists.clientHeight)*.9&&(await v(t),I(t,m?"/search":"/featured",x))},H=async(t,m=null)=>{t.query=m!==null?m:t.query,(!t.query||t.query.trim().length===0)&&(t.query=null),t.next=null,t.gifs=[],t.pointer=-1,await u(t),I(t,t.query===null?"/featured":"/search",{q:t.query,limit:t.limit})},d=t=>{if(!a.has(t)){document.getElementById(`gif-form-${t}`).innerHTML=c(t),a.set(t,{uuid:t,last:null,limit:null,query:null,next:null,col:null,pointer:-1,gifs:[],reqs:[],lists:document.getElementById(`gif-lists-${t}`)});let m=a.get(t),x=b.debounce(u,750),R=b.debounce(H,750),C=b.debounce(E,250);window.addEventListener("resize",()=>x(m)),m.lists.addEventListener("scroll",()=>C(m)),document.getElementById(`gif-search-${t}`).addEventListener("input",B=>R(m,B.target.value))}return a.get(t)};return{default:f,init:()=>{s=new Map,o=new Map,a=new Map,i=S("config"),i.get("tenor_key")===null&&document.querySelector('[onclick="undangan.comment.gif.open(undangan.comment.gif.default)"]')?.remove()},cache:g,back:async(t,m)=>{let x=b.disableButton(t,b.loader.replace("me-1","me-0"),!0);await v(a.get(m)),x.restore(),document.getElementById(`gif-form-${m}`).classList.toggle("d-none",!0),document.getElementById(`comment-form-${m}`)?.classList.toggle("d-none",!1)},open:async t=>{let m=d(t);document.getElementById(`gif-form-${t}`).classList.toggle("d-none",!1),document.getElementById(`comment-form-${t}`)?.classList.toggle("d-none",!0),o.has(t)&&o.get(t)(),await H(m)},cancel:t=>{let m=document.getElementById(`gif-result-${t}`);m.removeAttribute("data-id"),m.querySelector(`#gif-cancel-${t}`).classList.replace("d-flex","d-none"),m.querySelector("img").remove(),a.get(t).lists.classList.replace("d-none","d-flex"),document.getElementById(`gif-search-nav-${t}`).classList.replace("d-none","d-flex")},click:(t,m,x)=>{let R=document.getElementById(`gif-result-${t}`);R.setAttribute("data-id",m),R.querySelector(`#gif-cancel-${t}`).classList.replace("d-none","d-flex"),R.insertAdjacentHTML("beforeend",`<img src="${s.get(b.base64Decode(x))}" class="img-fluid mx-auto gif-image rounded-4" alt="selected-gif">`),a.get(t).lists.classList.replace("d-flex","d-none"),document.getElementById(`gif-search-nav-${t}`).classList.replace("d-flex","d-none")},remove:async(t=null)=>{t?a.has(t)&&(await v(a.get(t)),a.delete(t),o.delete(t)):(await Promise.all(Array.from(a.keys()).map(m=>v(a.get(m)))),a.clear(),o.clear())},isOpen:t=>{let m=document.getElementById(`gif-form-${t}`);return m===null?!1:!m.classList.contains("d-none")},onOpen:(t,m)=>o.set(t,m),getResultId:t=>document.getElementById(`gif-result-${t}`)?.getAttribute("data-id"),buttonCancel:(t=null)=>{let m=document.getElementById(`gif-cancel-${t||f}`);return{show:()=>m.classList.replace("d-none","d-flex"),hide:()=>m.classList.replace("d-flex","d-none"),click:()=>m.dispatchEvent(new Event("click"))}},removeGifSearch:t=>document.querySelector(`[for="gif-search-${t}"]`)?.remove(),removeButtonBack:t=>document.querySelector(`[onclick="undangan.comment.gif.back(this, '${t}')"]`)?.remove()}})();var F=(()=>{let l=null,f=null,y=null,s=null,a=null,o=null,i=300,g=[["*",'<strong class="text-theme-auto">$1</strong>'],["_",'<em class="text-theme-auto">$1</em>'],["~",'<del class="text-theme-auto">$1</del>'],["```",'<code class="font-monospace text-theme-auto">$1</code>']],k=()=>`
        <div class="bg-theme-auto shadow p-3 mx-0 mt-0 mb-3 rounded-4">
            <div class="d-flex justify-content-between align-items-center placeholder-wave">
                <span class="placeholder bg-secondary col-5 rounded-3 my-1"></span>
                <span class="placeholder bg-secondary col-3 rounded-3 my-1"></span>
            </div>
            <hr class="my-1">
            <p class="placeholder-wave m-0">
                <span class="placeholder bg-secondary col-6 rounded-3"></span>
                <span class="placeholder bg-secondary col-5 rounded-3"></span>
                <span class="placeholder bg-secondary col-12 rounded-3 my-1"></span>
            </p>
        </div>`,w=e=>(g.forEach(n=>{let r=n[0],h=n[1];e=e.replace(new RegExp(`\\${r}(?=\\S)(.*?)(?<!\\s)\\${r}`,"gs"),h)}),e),I=e=>`
        <button style="font-size: 0.8rem;" onclick="undangan.comment.like.love(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto ms-auto rounded-3 p-0 shadow-sm d-flex justify-content-start align-items-center" data-offline-disabled="false">
            <span class="my-0 mx-1" data-count-like="${e.like.love}">${e.like.love}</span>
            <i class="me-1 ${y.has(e.uuid)?"fa-solid fa-heart text-danger":"fa-regular fa-heart"}"></i>
        </button>`,c=e=>{let n=`<div class="d-flex justify-content-start align-items-center" data-button-action="${e.uuid}">`;return(s.get("can_reply")===!0||s.get("can_reply")===void 0)&&(n+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.reply(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Reply</button>`),f.has(e.uuid)&&(s.get("can_edit")===!0||s.get("can_edit")===void 0)&&!(e.gif_url&&s.get("tenor_key")===null)&&(n+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.edit(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Edit</button>`),A.isAdmin()?n+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.remove(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-own="${e.own}" data-offline-disabled="false">Delete</button>`:f.has(e.uuid)&&(s.get("can_delete")===!0||s.get("can_delete")===void 0)&&(n+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.remove(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Delete</button>`),n+="</div>",n},v=(e,n)=>{let r=o.get("show").includes(e);return`<a class="text-theme-auto" style="font-size: 0.8rem;" onclick="undangan.comment.showOrHide(this)" data-uuid="${e}" data-uuids="${n.join(",")}" data-show="${r?"true":"false"}" role="button" class="me-auto ms-1 py-0">${r?"Hide replies":`Show replies (${n.length})`}</a>`},u=e=>`
        <div class="d-flex justify-content-between align-items-center" id="button-${e.uuid}">
            ${c(e)}
            ${e.comments.length>0?v(e.uuid,e.comments.map(n=>n.uuid)):""}
            ${I(e)}
        </div>`,E=e=>e.ip===void 0||e.user_agent===void 0||e.is_admin?"":`
        <div class="mb-1 mt-3">
            <p class="text-theme-auto mb-1 mx-0 mt-0 p-0" style="font-size: 0.7rem;" id="ip-${e.uuid}"><i class="fa-solid fa-location-dot me-1"></i>${b.escapeHtml(e.ip)} ${a.has(e.ip)?`<strong>${a.get(e.ip)}</strong>`:'<span class="mb-1 placeholder col-2 rounded-3"></span>'}</p>
            <p class="text-theme-auto m-0 p-0" style="font-size: 0.7rem;"><i class="fa-solid fa-mobile-screen-button me-1"></i>${b.parseUserAgent(b.escapeHtml(e.user_agent))}</p>
        </div>`,H=(e,n)=>n?'class="bg-theme-auto shadow p-3 mx-0 mt-0 mb-3 rounded-4" data-parent="true"':`class="${o.get("hidden").find(r=>r.uuid===e.uuid).show?"":"d-none"} overflow-x-scroll mw-100 border-start bg-theme-auto py-2 ps-2 pe-0 my-2 ms-2 me-0"`,d=(e,n)=>e.is_admin?`<strong class="me-1">${b.escapeHtml(l.get("name")??s.get("name"))}</strong><i class="fa-solid fa-certificate text-primary"></i>`:n?`<strong class="me-1">${b.escapeHtml(e.name)}</strong><i id="badge-${e.uuid}" data-is-presence="${e.presence?"true":"false"}" class="fa-solid ${e.presence?"fa-circle-check text-success":"fa-circle-xmark text-danger"}"></i>`:`<strong>${b.escapeHtml(e.name)}</strong>`,p=async(e,n)=>{let r=`
        <div class="d-flex justify-content-between align-items-center">
            <p class="text-theme-auto text-truncate m-0 p-0" style="font-size: 0.95rem;">${d(e,n)}</p>
            <small class="text-theme-auto m-0 p-0" style="font-size: 0.75rem;">${e.created_at}</small>
        </div>
        <hr class="my-1">`;if(e.gif_url)return r+`
            <div class="d-flex justify-content-center align-items-center my-2">
                <img src="${await O.cache(e.gif_url)}" id="img-gif-${e.uuid}" class="img-fluid mx-auto gif-image rounded-4" alt="selected-gif">
            </div>`;let h=w(b.escapeHtml(e.comment)),L=h.length>i;return r+`
        <p class="text-theme-auto my-1 mx-0 p-0" style="white-space: pre-wrap !important; font-size: 0.95rem;" ${L?`data-comment="${b.base64Encode(h)}"`:""} id="content-${e.uuid}">${L?h.slice(0,i)+"...":h}</p>
        ${L?`<p class="d-block mb-2 mt-0 mx-0 p-0"><a class="text-theme-auto" role="button" style="font-size: 0.85rem;" data-show="false" onclick="undangan.comment.showMore(this, '${e.uuid}')">Selengkapnya</a></p>`:""}`},$=async(e,n)=>{let r=await p(e,n),h="";for(let L of e.comments)h+=await $(L,!1);return`
        <div ${H(e,n)} id="${e.uuid}" style="overflow-wrap: break-word !important;">
            <div id="body-content-${e.uuid}" data-tapTime="0" data-liked="false" tabindex="0">${r}</div>
            ${E(e)}
            ${u(e)}
            <div id="reply-content-${e.uuid}">${h}</div>
        </div>`};return{init:()=>{l=S("user"),f=S("owns"),y=S("likes"),s=S("config"),a=S("tracker"),o=S("comment")},renderEdit:(e,n,r,h)=>{let L=document.createElement("div");return L.classList.add("my-2"),L.id=`inner-${e}`,L.innerHTML=`
        <p class="my-1 mx-0 p-0" style="font-size: 0.95rem;"><i class="fa-solid fa-pen me-2"></i>Edit</p>
        ${r?`
        <select class="form-select shadow-sm mb-2 rounded-4" id="form-inner-presence-${e}" data-offline-disabled="false">
            <option value="1" ${n?"selected":""}>&#9989; Datang</option>
            <option value="2" ${n?"":"selected"}>&#10060; Berhalangan</option>
        </select>`:""}
        ${h?`${s.get("tenor_key")===null?"":`<div class="d-none mb-2" id="gif-form-${e}"></div>`}`:`<textarea class="form-control shadow-sm rounded-4 mb-2" id="form-inner-${e}" minlength="1" maxlength="1000" placeholder="Type update comment" rows="3" data-offline-disabled="false"></textarea>    
        `}
        <div class="d-flex justify-content-end align-items-center mb-0">
            <button style="font-size: 0.8rem;" onclick="undangan.comment.cancel(this, '${e}')" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1" data-offline-disabled="false">Cancel</button>
            <button style="font-size: 0.8rem;" onclick="undangan.comment.update(this)" data-uuid="${e}" class="btn btn-sm btn-outline-auto rounded-4 py-0" data-offline-disabled="false">Update</button>
        </div>`,L},renderReply:e=>{let n=document.createElement("div");return n.classList.add("my-2"),n.id=`inner-${e}`,n.innerHTML=`
        <p class="my-1 mx-0 p-0" style="font-size: 0.95rem;"><i class="fa-solid fa-reply me-2"></i>Reply</p>
        <div class="d-block mb-2" id="comment-form-${e}">
            <div class="position-relative">
                ${s.get("tenor_key")===null?"":`<button class="btn btn-secondary btn-sm rounded-4 shadow-sm me-1 my-1 position-absolute bottom-0 end-0" onclick="undangan.comment.gif.open('${e}')" aria-label="button gif" data-offline-disabled="false"><i class="fa-solid fa-photo-film"></i></button>`}
                <textarea class="form-control shadow-sm rounded-4 mb-2" id="form-inner-${e}" minlength="1" maxlength="1000" placeholder="Type reply comment" rows="3" data-offline-disabled="false"></textarea>
            </div>
        </div>
        <div class="d-none mb-2" id="gif-form-${e}"></div>
        <div class="d-flex justify-content-end align-items-center mb-0">
            <button style="font-size: 0.8rem;" onclick="undangan.comment.cancel(this, '${e}')" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1" data-offline-disabled="false">Cancel</button>
            <button style="font-size: 0.8rem;" onclick="undangan.comment.send(this)" data-uuid="${e}" class="btn btn-sm btn-outline-auto rounded-4 py-0" data-offline-disabled="false">Send</button>
        </div>`,n},renderLoading:k,renderReadMore:v,renderInnerContent:e=>$(e,!1),renderContent:e=>$(e,!0),convertMarkdownToHTML:w,maxCommentLength:i}})();var ge=()=>window.confetti.shapeFromPath({path:"M167 72c19,-38 37,-56 75,-56 42,0 76,33 76,75 0,76 -76,151 -151,227 -76,-76 -151,-151 -151,-227 0,-42 33,-75 75,-75 38,0 57,18 76,56z",matrix:[.03333333333333333,0,0,.03333333333333333,-5.566666666666666,-5.533333333333333]});var ce=l=>{if(!window.confetti)return;let f=Date.now()+25,y=Math.max(.3,Math.min(1,l.getBoundingClientRect().top/window.innerHeight+.2)),s=ge(),a=["#FF69B4","#FF1493"],o=()=>{a.forEach(i=>{window.confetti({particleCount:2,angle:60,spread:55,shapes:[s],origin:{x:0,y},zIndex:1057,colors:[i]}),window.confetti({particleCount:2,angle:120,spread:55,shapes:[s],origin:{x:1,y},zIndex:1057,colors:[i]})}),Date.now()<f&&requestAnimationFrame(o)};requestAnimationFrame(o)};var te=(()=>{let l=null,f=async o=>{let i=o.firstElementChild,g=o.lastElementChild,k=o.getAttribute("data-uuid"),w=parseInt(i.getAttribute("data-count-like"));o.disabled=!0,navigator.vibrate&&navigator.vibrate(100),l.has(k)?await P(X,"/api/comment/"+l.get(k)).token(A.getToken()).send(D.statusResponse).then(I=>{I.data.status&&(l.unset(k),g.classList.remove("fa-solid","text-danger"),g.classList.add("fa-regular"),i.setAttribute("data-count-like",String(w-1)))}):await P(Z,"/api/comment/"+k).token(A.getToken()).send(D.uuidResponse).then(I=>{I.code===se&&(l.set(k,I.data.uuid),g.classList.remove("fa-regular"),g.classList.add("fa-solid","text-danger"),i.setAttribute("data-count-like",String(w+1)))}),i.innerText=i.getAttribute("data-count-like"),o.disabled=!1},y=o=>document.querySelector(`button[onclick="undangan.comment.like.love(this)"][data-uuid="${o}"]`);return{init:()=>{l=S("likes")},love:f,tapTap:async o=>{if(!navigator.onLine)return;let i=Date.now(),g=i-parseInt(o.getAttribute("data-tapTime")),k=o.id.replace("body-content-",""),w=g<300&&g>0,I=!l.has(k)&&o.getAttribute("data-liked")!=="true";w&&I&&(ce(o),o.setAttribute("data-liked","true"),await f(y(k)),o.setAttribute("data-liked","false")),o.setAttribute("data-tapTime",i)},getButtonLike:y}})();var G=(()=>{let l=10,f=0,y=0,s=null,a=null,o=null,i=null,g=null,k=M=>{l=Number(M)},w=()=>l,I=()=>f,c=()=>y,v=()=>a.classList.contains("disabled")?null:a.classList.add("disabled"),u=()=>a.classList.contains("disabled")?a.classList.remove("disabled"):null,E=()=>o.classList.contains("disabled")?null:o.classList.add("disabled"),H=()=>o.classList.contains("disabled")?o.classList.remove("disabled"):null,d=M=>{E(),v();let V=b.disableButton(M,b.loader.replace("ms-0 me-1","mx-1"),!0),e=async()=>{let h=new Promise(L=>g.addEventListener("comment.result",L,{once:!0}));g.dispatchEvent(new Event("comment.show")),await h,V.restore(),g.scrollIntoView({behavior:"smooth"})};return{next:()=>{f+=l,M.innerHTML="Next"+M.innerHTML,e()},prev:()=>{f-=l,M.innerHTML=M.innerHTML+"Prev",e()}}};return{init:()=>{i=document.getElementById("pagination"),i.innerHTML=`
        <ul class="pagination mb-2 shadow-sm rounded-4">
            <li class="page-item disabled" id="previous">
                <button class="page-link rounded-start-4" onclick="undangan.comment.pagination.previous(this)" data-offline-disabled="false">
                    <i class="fa-solid fa-circle-left me-1"></i>Prev
                </button>
            </li>
            <li class="page-item disabled">
                <span class="page-link text-theme-auto" id="page"></span>
            </li>
            <li class="page-item" id="next">
                <button class="page-link rounded-end-4" onclick="undangan.comment.pagination.next(this)" data-offline-disabled="false">
                    Next<i class="fa-solid fa-circle-right ms-1"></i>
                </button>
            </li>
        </ul>`,g=document.getElementById("comments"),s=document.getElementById("page"),a=document.getElementById("previous"),o=document.getElementById("next")},setPer:k,getPer:w,getNext:I,reset:()=>f===0?!1:(f=0,E(),v(),!0),setTotal:M=>{if(y=Number(M),y===0||y<=l&&f===0){i.classList.add("d-none");return}let V=f/l+1,e=Math.ceil(y/l);if(s.innerText=`${V} / ${e}`,f>0&&u(),V>=e){E();return}H(),i.classList.contains("d-none")&&i.classList.remove("d-none")},geTotal:c,previous:M=>d(M).prev(),next:M=>d(M).next()}})();var ie=(()=>{let l=null,f=null,y=null,s=null,a=null,o=[],i=()=>`<div class="text-center p-4 mx-0 mt-0 mb-3 bg-theme-auto rounded-4 shadow"><p class="fw-bold p-0 m-0" style="font-size: 0.95rem;">${K.on("id","\u{1F4E2} Yuk, share undangan ini biar makin rame komentarnya! \u{1F389}").on("en","\u{1F4E2} Let's share this invitation to get more comments! \u{1F389}").get()}</p></div>`,g=(e,n)=>{document.querySelector(`[data-button-action="${e}"]`).childNodes.forEach(r=>{r.disabled=n})},k=e=>{g(e,!1),document.getElementById(`inner-${e}`).remove()},w=e=>{e.comments&&e.comments.forEach(w);let n=document.getElementById(`body-content-${e.uuid}`);n.addEventListener("touchend",()=>te.tapTap(n))},I=e=>{let n=e.getAttribute("data-uuids").split(","),r=e.getAttribute("data-show")==="true",h=e.getAttribute("data-uuid");r?(e.setAttribute("data-show","false"),e.innerText=`Show replies (${n.length})`,s.set("show",s.get("show").filter(L=>L!==h))):(e.setAttribute("data-show","true"),e.innerText="Hide replies",s.set("show",s.get("show").concat([h])));for(let L of n){s.set("hidden",s.get("hidden").map(q=>(q.uuid===L&&(q.show=!r),q)));let _=document.getElementById(L).classList;r?_.add("d-none"):_.remove("d-none")}},c=(e,n)=>{let r=document.getElementById(`content-${n}`),h=b.base64Decode(r.getAttribute("data-comment")),L=e.getAttribute("data-show")==="false";r.innerHTML=L?h:h.slice(0,F.maxCommentLength)+"...",e.innerText=L?"Sebagian":"Selengkapnya",e.setAttribute("data-show",L?"true":"false")},v=e=>{if(!A.isAdmin()||(e.comments&&e.comments.forEach(v),e.ip===void 0||e.user_agent===void 0||e.is_admin||y.has(e.ip)))return;let n=(r,h,L)=>{document.getElementById(`ip-${r}`).innerHTML=`<i class="fa-solid fa-location-dot me-1"></i>${b.escapeHtml(h)} <strong>${b.escapeHtml(L)}</strong>`};P(j,`https://freeipapi.com/api/json/${e.ip}`).default(Q).then(r=>r.json()).then(r=>{let h=r.cityName+" - "+r.regionName;r.cityName==="-"&&r.regionName==="-"&&(h="localhost"),y.set(e.ip,h),n(e.uuid,e.ip,h)}).catch(r=>n(e.uuid,e.ip,r.message))},u=(e,n=[])=>(e.forEach(r=>{n.find(h=>h.uuid===r.uuid)||n.push(D.commentShowMore(r.uuid)),r.comments&&r.comments.length>0&&u(r.comments,n)}),n),E=()=>(a.getAttribute("data-loading")==="false"&&(a.setAttribute("data-loading","true"),a.innerHTML=F.renderLoading().repeat(G.getPer())),P(j,`/api/v2/comment?per=${G.getPer()}&next=${G.getNext()}&lang=${K.getLanguage()}`).token(A.getToken()).send(D.getCommentsResponseV2).then(async e=>{a.setAttribute("data-loading","false");for(let r of o)await O.remove(r);if(e.data.lists.length===0)return a.innerHTML=i(),e;o=u(e.data.lists).map(r=>r.uuid),s.set("hidden",u(e.data.lists,s.get("hidden")));let n="";for(let r of e.data.lists)n+=await F.renderContent(r);return e.data.lists.length<G.getPer()&&(n+=i()),a.innerHTML=n,e.data.lists.forEach(v),e.data.lists.forEach(w),e}).then(e=>(G.setTotal(e.data.count),a.dispatchEvent(new Event("comment.result")),e)));return{gif:O,like:te,pagination:G,init:()=>{O.init(),te.init(),F.init(),G.init(),a=document.getElementById("comments"),a.addEventListener("comment.show",E),l=S("owns"),f=S("user"),y=S("tracker"),s=S("comment"),s.has("hidden")||s.set("hidden",[]),s.has("show")||s.set("show",[])},send:async e=>{let n=e.getAttribute("data-uuid"),r=document.getElementById("form-name"),h=r.value;if(A.isAdmin()&&(h=f.get("name")),h.length===0){alert("Name cannot be empty."),n&&document.getElementById("comment").scrollIntoView({behavior:"smooth"});return}let L=document.getElementById("form-presence");if(!n&&L&&L.value==="0"){alert("Please select your attendance status.");return}let _=O.isOpen(n||O.default),q=O.getResultId(n||O.default),t=O.buttonCancel(n);if(_&&!q){alert("Gif cannot be empty.");return}_&&q&&t.hide();let m=document.getElementById(`form-${n?`inner-${n}`:"comment"}`);if(!_&&m.value.length===0){alert("Comments cannot be empty.");return}!n&&r&&!A.isAdmin()&&(r.disabled=!0),!A.isAdmin()&&L&&L.value!=="0"&&(L.disabled=!0),m&&(m.disabled=!0);let x=document.querySelector(`[onclick="undangan.comment.cancel(this, '${n}')"]`);x&&(x.disabled=!0);let R=b.disableButton(e),C=L?L.value==="1":!0;if(!A.isAdmin()){let T=S("information");T.set("name",h),n||T.set("presence",C)}let B=await P(Z,`/api/comment?lang=${K.getLanguage()}`).token(A.getToken()).body(D.postCommentRequest(n,h,C,_?null:m.value,q)).send(D.getCommentResponse).then(T=>T,()=>null);if(r&&(r.disabled=!1),m&&(m.disabled=!1),x&&(x.disabled=!1),L&&(L.disabled=!1),_&&q&&t.show(),R.restore(),!(!B||B.code!==se)){if(l.set(B.data.uuid,B.data.own),m&&(m.value=null),_&&q&&t.click(),!n){if(G.reset()){await E(),a.scrollIntoView({behavior:"smooth"});return}G.setTotal(G.geTotal()+1),a.children.length===G.getPer()&&a.lastElementChild.remove(),B.data.is_admin=A.isAdmin();let T=await F.renderContent(B.data);a.insertAdjacentHTML("afterbegin",T),a.scrollIntoView({behavior:"smooth"})}if(n){s.set("hidden",s.get("hidden").concat([D.commentShowMore(B.data.uuid,!0)])),s.set("show",s.get("show").concat([n])),k(n),B.data.is_admin=A.isAdmin(),document.getElementById(`reply-content-${n}`).insertAdjacentHTML("beforeend",await F.renderInnerContent(B.data));let T=document.getElementById(`button-${n}`).querySelector("a"),N=[B.data.uuid];T&&(T.getAttribute("data-show")==="false"&&I(T),T.remove()),te.getButtonLike(n).insertAdjacentHTML("beforebegin",F.renderReadMore(n,T?T.getAttribute("data-uuids").split(",").concat(N):N))}w(B.data)}},edit:async e=>{let n=e.getAttribute("data-uuid");if(document.getElementById(`inner-${n}`))return;g(n,!0);let r=b.disableButton(e);await P(j,"/api/comment/"+n).token(A.getToken()).send(D.commentResponse).then(async h=>{if(h.code!==Y)return h;h.data.gif_url&&await O.remove(n);let L=document.getElementById(n).getAttribute("data-parent")==="true"&&!A.isAdmin();if(document.getElementById(`button-${n}`).insertAdjacentElement("afterend",F.renderEdit(n,h.data.presence,L,!!h.data.gif_url)),h.data.gif_url)return O.onOpen(n,()=>{O.removeGifSearch(n),O.removeButtonBack(n)}),O.open(n);let _=document.getElementById(`form-inner-${n}`);return _.value=h.data.comment,_.setAttribute("data-original",b.base64Encode(h.data.comment)),h}),r.restore(!0)},reply:async e=>{let n=e.getAttribute("data-uuid");if(document.getElementById(`inner-${n}`))return;g(n,!0);let r=b.disableButton(e);await O.remove(n),O.onOpen(n,()=>O.removeGifSearch(n)),r.restore(!0),document.getElementById(`button-${n}`).insertAdjacentElement("afterend",F.renderReply(n))},remove:async e=>{if(!confirm("Are you sure?"))return;let n=e.getAttribute("data-uuid");A.isAdmin()&&l.set(n,e.getAttribute("data-own")),g(n,!0);let r=b.disableButton(e),h=te.getButtonLike(n);if(h.disabled=!0,!await P(re,"/api/comment/"+l.get(n)).token(A.getToken()).send(D.statusResponse).then(_=>_.data.status,()=>!1)){r.restore(),h.disabled=!1;return}document.querySelectorAll('a[onclick="undangan.comment.showOrHide(this)"]').forEach(_=>{let q=_.getAttribute("data-uuids").split(",");if(q.find(t=>t===n)){let t=q.filter(m=>m!==n).join(",");t.length===0?_.remove():_.setAttribute("data-uuids",t)}}),l.unset(n),document.getElementById(n).remove(),a.children.length===0&&(a.innerHTML=i())},update:async e=>{let n=e.getAttribute("data-uuid"),r=!1,h=document.getElementById(`form-inner-presence-${n}`);h&&(h.disabled=!0,r=h.value==="1");let L=!1,_=document.getElementById(`badge-${n}`);_&&(L=_.getAttribute("data-is-presence")==="true");let q=O.isOpen(n),t=O.getResultId(n),m=O.buttonCancel(n);q&&t&&m.hide();let x=document.getElementById(`form-inner-${n}`);if(n&&!q&&b.base64Encode(x.value)===x.getAttribute("data-original")&&L===r){k(n);return}x&&(x.disabled=!0);let R=document.querySelector(`[onclick="undangan.comment.cancel(this, '${n}')"]`);R&&(R.disabled=!0);let C=b.disableButton(e),B=await P(oe,`/api/comment/${l.get(n)}?lang=${K.getLanguage()}`).token(A.getToken()).body(D.updateCommentRequest(h?r:null,q?null:x.value,t)).send(D.statusResponse).then(T=>T.data.status,()=>!1);if(x&&(x.disabled=!1),R&&(R.disabled=!1),h&&(h.disabled=!1),C.restore(),q&&t&&m.show(),!!B){if(q&&t&&(document.getElementById(`img-gif-${n}`).src=document.getElementById(`gif-result-${n}`)?.querySelector("img").src,m.click()),k(n),!q){let T=document.querySelector(`[onclick="undangan.comment.showMore(this, '${n}')"]`),N=F.convertMarkdownToHTML(b.escapeHtml(x.value)),z=document.getElementById(`content-${n}`);N.length>F.maxCommentLength?(z.innerHTML=T?.getAttribute("data-show")==="false"?N.slice(0,F.maxCommentLength)+"...":N,z.setAttribute("data-comment",b.base64Encode(N)),T?.classList.replace("d-none","d-block")):(z.innerHTML=N,z.removeAttribute("data-comment"),T?.classList.replace("d-block","d-none"))}h&&(document.getElementById("form-presence").value=r?"1":"2",S("information").set("presence",r)),!(!h||!_)&&(_.classList.toggle("fa-circle-xmark",!r),_.classList.toggle("text-danger",!r),_.classList.toggle("fa-circle-check",r),_.classList.toggle("text-success",r))}},cancel:async(e,n)=>{let r=document.getElementById(`form-inner-presence-${n}`),h=r?r.value==="1":!1,L=document.getElementById(`badge-${n}`),_=L&&l.has(n)&&r?L.getAttribute("data-is-presence")==="true":!1;if(b.disableButton(e),O.isOpen(n)&&(!O.getResultId(n)&&_===h||confirm("Are you sure?"))){await O.remove(n),k(n);return}let q=document.getElementById(`form-inner-${n}`);(q.value.length===0||b.base64Encode(q.value)===q.getAttribute("data-original")&&_===h||confirm("Are you sure?"))&&k(n)},show:E,showMore:c,showOrHide:I}})();var me=(()=>{let l=()=>ee.getDetailUser().then(d=>{document.getElementById("dashboard-name").innerHTML=`${b.escapeHtml(d.data.name)}<i class="fa-solid fa-hands text-warning ms-2"></i>`,document.getElementById("dashboard-email").innerHTML=d.data.email,document.getElementById("dashboard-accesskey").value=d.data.access_key,document.getElementById("button-copy-accesskey").setAttribute("data-copy",d.data.access_key),document.getElementById("form-name").value=b.escapeHtml(d.data.name),document.getElementById("filterBadWord").checked=!!d.data.is_filter,document.getElementById("replyComment").checked=!!d.data.can_reply,document.getElementById("editComment").checked=!!d.data.can_edit,document.getElementById("deleteComment").checked=!!d.data.can_delete,document.getElementById("dashboard-tenorkey").value=d.data.tenor_key,S("config").set("tenor_key",d.data.tenor_key)}),f=()=>{P(j,"/api/stats").token(A.getToken()).send().then(d=>{document.getElementById("count-comment").innerHTML=String(d.data.comments).replace(/\B(?=(\d{3})+(?!\d))/g,"."),document.getElementById("count-like").innerHTML=String(d.data.likes).replace(/\B(?=(\d{3})+(?!\d))/g,"."),document.getElementById("count-present").innerHTML=String(d.data.present).replace(/\B(?=(\d{3})+(?!\d))/g,"."),document.getElementById("count-absent").innerHTML=String(d.data.absent).replace(/\B(?=(\d{3})+(?!\d))/g,".")})},y=async d=>{let p=b.disableCheckbox(d);await P(X,"/api/user").token(A.getToken()).body({filter:!!d.checked}).send(),p.restore()},s=async d=>{let p=b.disableCheckbox(d);await P(X,"/api/user").token(A.getToken()).body({can_reply:!!d.checked}).send(),p.restore()},a=async d=>{let p=b.disableCheckbox(d);await P(X,"/api/user").token(A.getToken()).body({can_edit:!!d.checked}).send(),p.restore()},o=async d=>{let p=b.disableCheckbox(d);await P(X,"/api/user").token(A.getToken()).body({can_delete:!!d.checked}).send(),p.restore()},i=async d=>{let p=b.disableButton(d),$=document.getElementById("dashboard-tenorkey");$.disabled=!0,await P(X,"/api/user").token(A.getToken()).body({tenor_key:$.value.length?$.value:null}).send().then(()=>alert(`success ${$.value.length?"add":"remove"} tenor key`)),$.disabled=!1,p.restore()},g=async d=>{if(!confirm("Are you sure?"))return;let p=b.disableButton(d);await P(oe,"/api/key").token(A.getToken()).send(D.statusResponse).then($=>{$.data.status&&l()}),p.restore()},k=async d=>{let p=document.getElementById("old_password"),$=document.getElementById("new_password");if(p.value.length===0||$.value.length===0){alert("Password cannot be empty");return}p.disabled=!0,$.disabled=!0;let U=b.disableButton(d),M=await P(X,"/api/user").token(A.getToken()).body({old_password:p.value,new_password:$.value}).send(D.statusResponse).then(V=>V.data.status,()=>!1);U.restore(!0),p.disabled=!1,$.disabled=!1,M&&(p.value=null,$.value=null,alert("Success change password"))},w=async d=>{let p=document.getElementById("form-name");if(p.value.length===0){alert("Name cannot be empty");return}p.disabled=!0;let $=b.disableButton(d),U=await P(X,"/api/user").token(A.getToken()).body({name:p.value}).send(D.statusResponse).then(M=>M.data.status,()=>!1);p.disabled=!1,$.restore(!0),U&&(l(),alert("Success change name"))},I=async d=>{let p=b.disableButton(d);await P(j,"/api/download").token(A.getToken()).download(),p.restore()},c=()=>{let d=document.getElementById("button-change-name");d.disabled&&(d.disabled=!1)},v=()=>{let d=document.getElementById("button-change-password"),p=document.getElementById("old_password");d.disabled&&p.value.length!==0&&(d.disabled=!1)},u=()=>{confirm("Are you sure?")&&ee.clearSession()},E=()=>{K.init(),K.setDefault("en"),de.init(),ae.spyTop();let d=async()=>{await l(),f(),ie.init(),ie.show()};document.addEventListener("hidden.bs.modal",d);try{let p=window.location.href.split("?k=");p.length>1&&p[1].length>=1&&(A.setToken(p[1]),window.history.replaceState({},document.title,p[0]));let $=A.decode()?.exp;if(!$||$<Date.now()/1e3)throw new Error("Invalid token");d()}catch{ee.clearSession()}};return{init:()=>(ee.init(),ae.init(),A.init(),A.isAdmin()||(S("owns").clear(),S("likes").clear(),S("config").clear(),S("comment").clear(),S("session").clear(),S("information").clear()),window.addEventListener("DOMContentLoaded",E),{util:b,theme:ae,comment:ie,admin:{auth:ee,navbar:le,logout:u,tenor:i,download:I,regenerate:g,editComment:a,replyComment:s,deleteComment:o,changeName:w,changePassword:k,changeFilterBadWord:y,enableButtonName:c,enableButtonPassword:v}})}})();(l=>{l.undangan=me.init()})(window);})();
